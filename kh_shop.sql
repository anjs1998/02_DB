/*1. 카테고리 테이블 (CATEGORIES)
카테고리 ID (CATEGORY_ID) - NUMBER [PK]
카테고리 이름 (CATEGORY_NAME) - VARCHAR2(100) [UNIQUE]

2. 상품 정보 테이블 (PRODUCTS)
상품 코드 (PRODUCT_ID) - NUMBER [PK]
상품 이름 (PRODUCT_NAME) - VARCHAR2(100) [NOT NULL]
카테고리 (CATEGORY) - NUMBER [FK - CATEGORIES(CATEGORY_ID)]
가격 (PRICE) - NUMBER [DEFAULT 0]
재고량 (STOCK_QUANTITY) NUMBER [DEFAULT 0]

3. 고객 정보 테이블 (CUSTOMERS)
고객 ID (CUSTOMER_ID) - NUMBER [PK]
이름 (NAME) - VARCHAR2(20) [NOT NULL]
성별 (GENDER) - CHAR(3) [CHECK 남, 여]
주소 (ADDRESS) - VARCHAR2(100)
전화번호 (PHONE) - VARCHAR2(30)

4. 주문 정보 테이블 (ORDERS)
주문 번호 (ORDER_ID) - NUMBER [PK]
주문일 (ORDER_DATE) - DATE [DEFAULT SYSDATE]
처리상태 (STATUS) - CHAR(1) [CHECK ('Y', 'N') DEFAULT 'N']
고객 ID (CUSTOMER_ID) - NUMBER [FK - CUSTOMERS(CUSTOMER_ID) ON DELETE
CASCADE]

5. 주문 상세 정보 테이블 (ORDER_DETAILS)
주문 상세 ID (ORDER_DETAIL_ID) - NUMBER [PK]
주문 번호 (ORDER_ID) NUMBER - [FK - ORDERS(ORDER_ID) ON DELETE CASCADE]
상품 코드 (PRODUCT_ID) NUMBER - [FK - PRODUCTS(PRODUCT_ID) ON DELETE
SET NULL]
수량 (QUANTITY) NUMBER
가격 (PRICE_PER_UNIT) NUMBER
*/

CREATE TABLE CATEGORIES(
	CATEGORY_ID NUMBER PRIMARY KEY,
	CATEGORY_NAME VARCHAR2(100) UNIQUE
);
DROP TABLE PRODUCTS CASCADE CONSTRAINTS;
CREATE TABLE PRODUCTS(
	PRODUCT_ID NUMBER PRIMARY KEY,
	PRODUCT_NAME VARCHAR2(100) NOT NULL,
	CATEGORY NUMBER REFERENCES CATEGORIES(CATEGORY_ID),
	PRICE  NUMBER DEFAULT 0,
	STOCK_QUANTITY NUMBER DEFAULT 0
);

CREATE TABLE CUSTOMERS(
	CUSTOMER_ID  NUMBER PRIMARY KEY,
	NAME  VARCHAR2(20) NOT NULL,
	GENDER  CHAR(3) CHECK ( GENDER IN('남', '여') ),
	ADDRESS  VARCHAR2(100),
	PHONE  VARCHAR2(30)
);

DROP TABLE ORDERS CASCADE CONSTRAINTS;
CREATE TABLE ORDERS(
	ORDER_ID NUMBER PRIMARY KEY,
	ORDER_DATE DATE DEFAULT SYSDATE,

	STATUS CHAR(1) DEFAULT 'N' CHECK( STATUS IN('Y', 'N') ),
	CUSTOMER_ID NUMBER REFERENCES CUSTOMERS(CUSTOMER_ID) ON DELETE CASCADE
);


CREATE TABLE ORDER_DETAILS(
ORDER_DETAIL_ID NUMBER,
ORDER_ID NUMBER REFERENCES ORDERS(ORDER_ID) ON DELETE CASCADE,
PRODUCT_ID NUMBER REFERENCES PRODUCTS(PRODUCT_ID) ON DELETE
SET NULL,
QUANTITY NUMBER,
PRICE_PER_UNIT NUMBER
);

INSERT INTO CATEGORIES VALUES('1', '스마트폰');
INSERT INTO CATEGORIES VALUES('2', 'TV');
INSERT INTO CATEGORIES VALUES('3', 'GAMING');

INSERT INTO PRODUCTS VALUES(101, 'Apple iPhone 12', 1, 1500000, 30);
INSERT INTO PRODUCTS VALUES(102, 'Apple iPhone 12', 1, 1800000, 50);
INSERT INTO PRODUCTS VALUES(201, 'Apple iPhone 12', 2, 3600000, 10);
INSERT INTO PRODUCTS VALUES(301, 'Apple iPhone 12', 3, 700000, 15);
--ALTER USER kh_shop DEFAULT TABLESPACE USERS QUOTA UNLIMITED ON USERS;

INSERT INTO CUSTOMERS VALUES(1, '홍길동', '남', '서울시 성동구 왕십리', '010-1111-2222');
INSERT INTO CUSTOMERS VALUES(2, '유관순', '여', '서울시 종로구 안국동', '010-3333-1111');

INSERT INTO ORDERS VALUES(576, '2024-02-29', 'N', 1);
INSERT INTO ORDERS VALUES(978, '2024-03-11', 'Y', 2);
INSERT INTO ORDERS VALUES(777, '2024-03-11', 'N', 2);
INSERT INTO ORDERS VALUES(134, '2022-12-25', 'Y', 1);
INSERT INTO ORDERS VALUES(499, '2020-01-03', 'Y', 1);

INSERT INTO ORDER_DETAILS VALUES(111, 576, 101, 1, 1500000);
INSERT INTO ORDER_DETAILS VALUES(222, 978, 201, 2, 3600000);
INSERT INTO ORDER_DETAILS VALUES(333, 978, 102, 1, 1800000);
INSERT INTO ORDER_DETAILS VALUES(444, 777, 301, 5, 700000);
INSERT INTO ORDER_DETAILS VALUES(555, 134, 102, 1, 1800000);
INSERT INTO ORDER_DETAILS VALUES(666, 499, 201, 3, 3600000);

------1. 번 정답
SELECT CUSTOMERS.NAME, ORDER_DATE, STATUS
FROM ORDERS, CUSTOMERS
WHERE ORDERS.CUSTOMER_ID = CUSTOMERS.CUSTOMER_ID
AND STATUS = 'N';


------2. 번 정답
SELECT ORDER_ID, ORDER_DATE, STATUS
FROM ORDERS
--LEFT JOIN ORDER_DETAILS ON(ORDERS.ORDER_ID = ORDER_DETAILS.ORDER_DETAIL_ID )
LEFT JOIN CUSTOMERS ON(ORDERS.CUSTOMER_ID = CUSTOMERS.CUSTOMER_ID )
WHERE CUSTOMERS.NAME = '홍길동'
AND ORDER_DATE >= '2024-01-01' ;

------3. 번 정답
SELECT ORDER_ID, PRODUCTS.PRODUCT_NAME, QUANTITY, PRICE_PER_UNIT, QUANTITY * PRICE_PER_UNIT
FROM ORDERS
LEFT OUTER JOIN ORDER_DETAILS ON( ORDER_ID )
LEFT OUTER JOIN PRODUCTS ON( PRODUCT_ID )
LEFT OUTER JOIN CUSTOMERS ON(CUSTOMER_ID )
WHERE CUSTOMERS.NAME = '유관순';